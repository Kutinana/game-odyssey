<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>按右键启动翻译器</title>
    
    <meta data-locale-title="cn" content="按右键启动翻译器">
    <meta data-locale-title="en" content="Right Click to Activate Translator">
    
    <script>
      // Apply saved theme early to avoid FOUC
      (function() {
        try {
          var saved = localStorage.getItem('theme');
          var systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          var isDark = saved ? saved === 'dark' : systemDark;
          var root = document.documentElement;
          if (isDark) root.classList.add('dark'); else root.classList.remove('dark');
        } catch (e) {}
      })();
      // Expose scrollbar width as CSS var (--sbw) to avoid 100vw overflow issues
      (function(){
        try {
          var root = document.documentElement;
          function setSBW(){
            var sbw = window.innerWidth - root.clientWidth;
            root.style.setProperty('--sbw', (sbw > 0 ? sbw : 0) + 'px');
          }
          setSBW();
          window.addEventListener('resize', setSBW, { passive: true });
        } catch(e) {}
      })();
      // Apply persisted fonts-loaded flag early to avoid re-swap
      (function(){
        try {
          var has = localStorage.getItem('fonts-loaded') === '1';
          var check = function(q){ try { return document.fonts && document.fonts.check(q); } catch(e){ return false; } };
          if (has && (check('400 1em "LXGWBright"') || check('1em LXGWBright'))) {
            document.documentElement.classList.add('fonts-loaded');
          }
        } catch (e) {}
      })();
    </script>
    <link rel="stylesheet" href="/assets/styles.css">
    <link rel="preload" href="/assets/fonts/LXGWBright-Light.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="/assets/fonts/LXGWBright-LightItalic.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="/assets/fonts/LXGWBright-Regular.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="/assets/fonts/LXGWBright-Italic.woff2" as="font" type="font/woff2" crossorigin>
    <script>
      // Persist fonts-loaded after first success in this or any tab
      (function(){
        if (!('fonts' in document)) return;
        try {
          var promises = [
            document.fonts.load('400 1em "LXGWBright"'),
            document.fonts.load('700 1em "LXGWBright"'),
            document.fonts.load('italic 400 1em "LXGWBright"'),
            document.fonts.load('italic 700 1em "LXGWBright"')
          ];
          Promise.all(promises).then(function(){
            document.documentElement.classList.add('fonts-loaded');
            try { localStorage.setItem('fonts-loaded','1'); } catch(e) {}
          });
        } catch (e) {}
      })();
    </script>
  </head>
  <body class="bg-neutral-50 text-neutral-900 dark:bg-neutral-950 dark:text-neutral-100 selection:bg-indigo-500/30">
    <header class="fixed top-0 inset-x-0 z-50">
      <nav class="max-w-6xl mx-auto mt-2 px-4 py-2 rounded-xl border border-black/5 dark:border-white/10 bg-white/40 dark:bg-neutral-900/30 backdrop-blur-2xl">
          <div class="flex items-center justify-between">
            <a href="/" class="text-sm font-semibold tracking-wide text-neutral-900 dark:text-neutral-100" data-i18n="site.title">
              香港中文大学（深圳）游戏研究社
            </a>
            <div id="navTabs" data-active="projects" class="hidden md:flex relative items-center gap-3 text-sm">
              <span id="navIndicator" class="nav-indicator absolute rounded-lg opacity-0"></span>
              <a href="/" data-tab="home" data-nav class="px-3 py-1 rounded-lg transition-colors text-neutral-600 dark:text-neutral-300 hover:text-neutral-900 dark:hover:text-white" data-i18n="nav.home">Home</a>
              <a href="/projects/" data-tab="projects" data-nav class="px-3 py-1 rounded-lg transition-colors text-neutral-900 dark:text-white" data-i18n="nav.projects">Projects</a>
              <a href="/about/" data-tab="about" data-nav class="px-3 py-1 rounded-lg transition-colors text-neutral-600 dark:text-neutral-300 hover:text-neutral-900 dark:hover:text-white" data-i18n="nav.about">About</a>
            </div>
            <div class="flex items-center gap-2">
              <button id="mobileMenuToggle" aria-label="Open menu" aria-controls="mobileMenu" aria-expanded="false" class="inline-flex items-center justify-center w-9 h-9 rounded-lg border border-black/5 dark:border-white/10 bg-white/40 hover:bg-white/60 dark:bg-neutral-800/30 dark:hover:bg-neutral-700/40 text-neutral-900 dark:text-neutral-100 transition-colors md:hidden" data-nav>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/></svg>
              </button>
              <button id="themeToggle" aria-label="Toggle theme" class="inline-flex items-center justify-center w-9 h-9 rounded-lg border border-black/5 dark:border-white/10 bg-white/40 hover:bg-white/60 dark:bg-neutral-800/30 dark:hover:bg-neutral-700/40 text-neutral-900 dark:text-neutral-100 transition-colors">
                <svg id="iconMoon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/></svg>
                <svg id="iconSun" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M10 15a5 5 0 100-10 5 5 0 000 10zm0 5a1 1 0 011-1h0a1 1 0 110 2h0a1 1 0 01-1-1zm0-20a1 1 0 011 1h0a1 1 0 11-2 0h0a1 1 0 011-1zm10 10a1 1 0 01-1 1h0a1 1 0 110-2h0a1 1 0 011 1zM1 10a1 1 0 011-1h0a1 1 0 110 2h0A1 1 0 011 10zm15.657-6.657a1 1 0 010 1.414h0a1 1 0 11-1.414-1.414h0a1 1 0 011.414 0zM4.757 15.243a1 1 0 010 1.414h0a1 1 0 11-1.414-1.414h0a1 1 0 011.414 0zM15.657 15.243a1 1 0 011.414 0h0a1 1 0 11-1.414 1.414h0a1 1 0 010-1.414zM4.757 4.757A1 1 0 003.343 3.343h0A1 1 0 114.757 4.757z"/></svg>
              </button>
              <button id="langToggle" class="text-sm px-3 py-2 rounded-lg border border-black/5 dark:border-white/10 bg-white/40 hover:bg-white/60 dark:bg-neutral-800/30 dark:hover:bg-neutral-700/40 text-neutral-900 dark:text-neutral-100 transition-colors">EN</button>
            </div>
          </div>
        <!-- Mobile menu (hidden on md and up) -->
        <div id="mobileMenu" class="md:hidden hidden mt-2 px-4 py-2 rounded-xl border border-black/5 dark:border-white/10 bg-white/80 dark:bg-neutral-900/70 backdrop-blur-md transition-all duration-200 ease-out transform origin-top opacity-0 -translate-y-1 pointer-events-none">
          <div class="flex flex-col gap-2 text-sm">
            <a href="/" class="px-3 py-2 rounded-lg text-neutral-900 dark:text-neutral-100 hover:bg-white/70 dark:hover:bg-neutral-800/60 transition-colors" data-nav data-i18n="nav.home">Home</a>
            <a href="/projects/" class="px-3 py-2 rounded-lg text-neutral-900 dark:text-neutral-100 hover:bg-white/70 dark:hover:bg-neutral-800/60 transition-colors" data-nav data-i18n="nav.projects">Projects</a>
            <a href="/about/" class="px-3 py-2 rounded-lg text-neutral-900 dark:text-neutral-100 hover:bg-white/70 dark:hover:bg-neutral-800/60 transition-colors" data-nav data-i18n="nav.about">About</a>
          </div>
        </div>
      </nav>
    </header>

    <!-- Mobile overlay (dims background when menu open) -->
    <div id="mobileMenuOverlay" class="md:hidden hidden fixed inset-0 z-40 bg-black/30 dark:bg-black/50 opacity-0 transition-opacity duration-200"></div>

    <div id="swup" class="swup-fade opacity-0">
      <main class="max-w-6xl mx-auto p-4 pt-24">
        










<section class="relative h-72 w-full overflow-hidden mb-6 bg-white dark:bg-transparent left-1/2 -translate-x-1/2" style="width:calc(100vw - var(--sbw, 0px));margin-top:-6rem;">
  
  <div class="absolute inset-0 hero-bg" style="background-image:url('/projects/rcat/banner.jpg')"></div>
  <div class="absolute inset-0 hero-overlay"></div>
  <div class="relative z-10 h-full flex items-center justify-center text-center">
    
    <div>
      <h1 data-locale="cn" class="text-3xl font-bold tracking-tight text-neutral-900 dark:text-white drop-shadow-sm" style="display:none">按右键启动翻译器</h1>
      <h1 data-locale="en" class="text-3xl font-bold tracking-tight text-neutral-900 dark:text-white drop-shadow-sm" style="display:none">Right Click to Activate Translator</h1>
      
      
      <p data-locale="cn" class="mt-2 text-base sm:text-lg text-neutral-900 dark:text-neutral-100 drop-shadow-sm" style="display:none">蛸猫生态与行为学实验研究中心</p>
      <p data-locale="en" class="mt-2 text-base sm:text-lg text-neutral-900 dark:text-neutral-100 drop-shadow-sm" style="display:none">Octocat Ecology and Behaviour Experimental Research Institute</p>
      
    </div>
    
  </div>
</section>


<article class="max-w-3xl mx-auto p-4">
  
  
  
  
  
  
  
  
  
  
  <meta data-locale-title="cn" content="按右键启动翻译器">
  <meta data-locale-title="en" content="Right Click to Activate Translator">
  
  
  
  
  
  
  
  
  
  <div>
    <article data-locale="cn" class="md-content" style="display:none"><p>《按右键启动翻译器》是一款横版剧情向语言解谜游戏，在寻找失踪的宠物猫“小白”的途中，一定不会发生什么穿越到异世界然后面对陌生的语言和“章鱼猫”顺便要拯救世界这种王道征途的剧情吧……记住，“按右键启动翻译器”。</p>
<h1>关于游戏</h1>
<hr>
<p>《按右键启动翻译器》是由鞘猫生态与行为学实验研究中心开发的一款横版剧情向语言解谜游戏。该游戏获 2024 中国大学生游戏开发创作大赛 CUSGA 最佳解谜游戏奖。</p>
<p>“你”所收留的流浪猫“小白”失踪了……</p>
<p>“你”急忙下楼寻找，直到你触碰到了一幅之前没有注意到的壁画。</p>
<p>突如其来的异世界穿越……无法理解的古怪文字……似由“猫”与“章鱼”络合的异族生物……</p>
<p>“你”马上意识到，这次找猫的旅途只是庞大异世界风物志异中的小小注脚。</p>
<h1>相关链接</h1>
<hr>
<p>Steam 商店页：<a href="https://store.steampowered.com/app/3128590/">按右键启动翻译器</a></p>
<h1>关于招募</h1>
<hr>
<p>我们目前正在招募 <strong>2D 美术</strong> 人才。无论你是否熟悉像素风格的艺术，只要你对一同构建一个章鱼猫猫异世界感兴趣的话，欢迎通过邮箱联系我们。随信请附上您的作品集与我们对您的称呼。</p>
<p>邮箱：kanade [at] <a href="http://yoisaki.com">yoisaki.com</a></p>
</article>
    <article data-locale="en" class="md-content" style="display:none"><p>Right Click To Activate Translator is a pixel side-scrolling language puzzle game. On your journey to find your missing pet cat “Shiro,” you are transported to an otherworldly realm, facing an unfamiliar language and “Octocats.” Remember, “Right Click to Open the Translator.”</p>
</article>
  </div>
  
  
  <section class="mt-8">
    <div class="md-content mb-3">
      <h1>
        <span data-locale="cn" style="display:none">截图</span>
        <span data-locale="en" style="display:none">Screenshots</span>
      </h1>
      <hr />
    </div>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      
        
          <img src="/projects/rcat/screenshots/1.jpg" alt="screenshot 1" class="w-full rounded-md cursor-zoom-in js-shot" data-index="0" />
        
      
        
          <img src="/projects/rcat/screenshots/2.jpg" alt="screenshot 2" class="w-full rounded-md cursor-zoom-in js-shot" data-index="1" />
        
      
        
          <img src="/projects/rcat/screenshots/3.jpg" alt="screenshot 3" class="w-full rounded-md cursor-zoom-in js-shot" data-index="2" />
        
      
        
      
        
      
      
      <div class="relative rounded-md overflow-hidden cursor-pointer js-shot" data-index="3">
        <img src="/projects/rcat/screenshots/4.jpg" alt="more screenshots" class="w-full blur-sm brightness-75" />
        <div class="absolute inset-0 flex items-center justify-center">
          <span class="text-white text-sm sm:text-base font-medium bg-black/50 px-3 py-1 rounded" data-locale="en" style="display:none">and more....</span>
          <span class="text-white text-sm sm:text-base font-medium bg-black/50 px-3 py-1 rounded" data-locale="cn" style="display:none">还有更多……</span>
        </div>
      </div>
      
    </div>
  </section>
  
  <script>
    (function(){
      try {
        var locale = localStorage.getItem('locale') || 'cn';
        if (locale === 'zh') locale = 'cn';
        document.querySelectorAll('[data-locale]').forEach(function(el){
          el.style.display = (el.getAttribute('data-locale') === locale ? '' : 'none');
        });
      } catch (e) {}

      // Lightbox implementation
      try {
        var shots = [
          
            "/projects/rcat/screenshots/1.jpg",
          
            "/projects/rcat/screenshots/2.jpg",
          
            "/projects/rcat/screenshots/3.jpg",
          
            "/projects/rcat/screenshots/4.jpg",
          
            "/projects/rcat/screenshots/5.jpg"
          
        ];

        if (Array.isArray(shots) && shots.length) {
          var current = 0;

          // Create lightbox container
          var lb = document.createElement('div');
          lb.setAttribute('id', 'lightbox');
          lb.className = 'fixed inset-0 hidden items-center justify-center z-50';

          lb.innerHTML = ''+
            '<div data-el="backdrop" class="absolute inset-0 bg-black/80 opacity-0 transition-opacity duration-200"></div>'+
            '<div class="relative px-8 pt-4 pb-6">'+
              '<img data-el="image" alt="screenshot" class="mx-auto w-auto h-auto max-w-[90vw] max-h-[85vh] rounded-md shadow-lg transform scale-95 opacity-0 transition duration-200" />'+
            '</div>'+
            '<button type="button" data-el="close" aria-label="Close" class="absolute top-4 right-4 text-white/90 hover:text-white text-2xl leading-none">×</button>'+
            '<button type="button" data-el="prev" aria-label="Previous" class="absolute left-4 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-black/50 hover:bg-black/60 text-white flex items-center justify-center border border-white/20 shadow-lg focus:outline-none focus-visible:ring-2 focus-visible:ring-white/60">‹</button>'+
            '<button type="button" data-el="next" aria-label="Next" class="absolute right-4 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-black/50 hover:bg-black/60 text-white flex items-center justify-center border border-white/20 shadow-lg focus:outline-none focus-visible:ring-2 focus-visible:ring-white/60">›</button>'+
            '<div data-el="counter" class="absolute bottom-4 left-1/2 -translate-x-1/2 text-white/85 text-sm"></div>';

          document.body.appendChild(lb);

          var elBackdrop = lb.querySelector('[data-el="backdrop"]');
          var elImage = lb.querySelector('[data-el="image"]');
          var elClose = lb.querySelector('[data-el="close"]');
          var elPrev = lb.querySelector('[data-el="prev"]');
          var elNext = lb.querySelector('[data-el="next"]');
          var elCounter = lb.querySelector('[data-el="counter"]');

          function updateCounter(){
            elCounter.textContent = (current + 1) + ' / ' + shots.length;
          }

          function show(index){
            if (index < 0) index = shots.length - 1;
            if (index >= shots.length) index = 0;
            current = index;
            elImage.src = shots[current];
            updateCounter();
            lb.classList.remove('hidden');
            lb.classList.add('flex');
            requestAnimationFrame(function(){
              elBackdrop.classList.add('opacity-100');
              elImage.classList.remove('scale-95','opacity-0');
              elImage.classList.add('scale-100','opacity-100');
            });
          }

          function hide(){
            elBackdrop.classList.remove('opacity-100');
            elImage.classList.remove('scale-100','opacity-100');
            elImage.classList.add('scale-95','opacity-0');
            setTimeout(function(){
              lb.classList.remove('flex');
              lb.classList.add('hidden');
            }, 180);
          }

          elClose.addEventListener('click', function(){ hide(); try { this.blur(); } catch(e) {} });
          elBackdrop.addEventListener('click', hide);
          elPrev.addEventListener('click', function(){ show(current - 1); try { this.blur(); } catch(e) {} });
          elNext.addEventListener('click', function(){ show(current + 1); try { this.blur(); } catch(e) {} });

          document.addEventListener('keydown', function(e){
            if (lb.classList.contains('hidden')) return;
            if (e.key === 'Escape') hide();
            else if (e.key === 'ArrowLeft') show(current - 1);
            else if (e.key === 'ArrowRight') show(current + 1);
          });

          // Bind thumbnails
          document.querySelectorAll('.js-shot').forEach(function(node){
            node.addEventListener('click', function(){
              var idx = parseInt(node.getAttribute('data-index') || '0', 10) || 0;
              show(idx);
            });
          });
        }
      } catch (err) {
        // noop
      }
    })();
  </script>
 </article>


      </main>
    </div>

    <script>
      (function() {
        // Register service worker for font caching
        try {
          if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js');
          }
        } catch (e) {}
        var root = document.documentElement;
        var btn = document.getElementById('themeToggle');
        var iconMoon = document.getElementById('iconMoon');
        var iconSun = document.getElementById('iconSun');
        function setIcon(dark) {
          if (!iconMoon || !iconSun) return;
          if (dark) { iconMoon.classList.add('hidden'); iconSun.classList.remove('hidden'); }
          else { iconSun.classList.add('hidden'); iconMoon.classList.remove('hidden'); }
        }
        // Do not bind here to avoid double handlers; handled in bindUi()

        // Minimal i18n for nav and CTA
        var dict = { cn: {"site.title":"香港中文大学（深圳）游戏研究社","site.description":"玩耍，创造，分享","nav.home":"首页","nav.projects":"项目","nav.about":"关于","hero.cta":"查看项目","project.recruiting":"招募中","project.screenshots":"截图","project.screenshots.more":"还有更多……","projects.search.placeholder":"搜索项目、团队或标签","projects.filter.recruiting":"只看招募中","home.recent.title":"最近项目","home.recent.viewAll":"查看全部项目"}, en: {"site.title":"CUHK(SZ) Gaming Odyssey","site.description":"Play, Create, Share","nav.home":"Home","nav.projects":"Projects","nav.about":"About","hero.cta":"View Projects","project.recruiting":"Recruiting","project.screenshots":"Screenshots","project.screenshots.more":"and more....","projects.search.placeholder":"Search projects, teams or tags","projects.filter.recruiting":"Recruiting only","home.recent.title":"Recent Projects","home.recent.viewAll":"View all projects"} };
        var rootLocale = (localStorage.getItem('locale') || 'cn');
        if (rootLocale === 'zh') rootLocale = 'cn';
        var langToggle = document.getElementById('langToggle');
        function applyLocale(locale) {
          // Backward compatibility: map 'zh' -> 'cn'
          if (locale === 'zh') locale = 'cn';
          var data = (dict && dict[locale]) || (dict && dict.cn) || {};
          // Optional per-page localized title from meta tags (set server-side)
          document.querySelectorAll('[data-i18n]').forEach(function(el) {
            var key = el.getAttribute('data-i18n');
            if (data[key]) el.textContent = data[key];
          });
          root.setAttribute('lang', locale === 'en' ? 'en' : 'zh-CN');
          // Toggle any localized elements (titles, team, markdown, etc.)
          try {
            document.querySelectorAll('[data-locale]')
              .forEach(function(el){ el.style.display = (el.getAttribute('data-locale') === locale ? '' : 'none'); });
            // Update <title> if per-page localized title is provided
            try {
              var metaCn = document.querySelector('meta[data-locale-title="cn"]');
              var metaEn = document.querySelector('meta[data-locale-title="en"]');
              var t = (locale === 'en' ? (metaEn && metaEn.getAttribute('content')) : (metaCn && metaCn.getAttribute('content')));
              if (t && typeof t === 'string' && t.trim().length > 0) { document.title = t; }
            } catch (e) {}
            // Reposition nav indicator after labels change width
            var nav = document.getElementById('navTabs');
            var indicator = document.getElementById('navIndicator');
            if (nav && indicator) {
              var activeKey = nav.getAttribute('data-active');
              var target = nav.querySelector('a[data-tab="' + activeKey + '"]');
              if (target) {
                var r = target.getBoundingClientRect();
                var nr = nav.getBoundingClientRect();
                indicator.style.left = (r.left - nr.left - 4) + 'px';
                indicator.style.width = (r.width + 8) + 'px';
                indicator.style.top = (r.top - nr.top - 2) + 'px';
                indicator.style.opacity = '1';
              }
            }
          } catch (e) {}
        }
        function bindUi() {
          // Re-select elements after page replacement
          btn = document.getElementById('themeToggle');
          iconMoon = document.getElementById('iconMoon');
          iconSun = document.getElementById('iconSun');
          langToggle = document.getElementById('langToggle');
          var mobileToggle = document.getElementById('mobileMenuToggle');
          var mobileMenu = document.getElementById('mobileMenu');
          var mobileOverlay = document.getElementById('mobileMenuOverlay');
          // Nav indicator follow
          try {
            var nav = document.getElementById('navTabs');
            var indicator = document.getElementById('navIndicator');
            if (nav && indicator) {
              var tabs = Array.prototype.slice.call(nav.querySelectorAll('a[data-tab]'));
              function positionTo(el) {
                var r = el.getBoundingClientRect();
                var nr = nav.getBoundingClientRect();
                indicator.style.left = (r.left - nr.left - 4) + 'px';
                indicator.style.width = (r.width + 8) + 'px';
                indicator.style.top = (r.top - nr.top - 2) + 'px';
                indicator.style.opacity = '1';
              }
              var activeKey = nav.getAttribute('data-active');
              var activeEl = tabs.find(function(t){ return t.getAttribute('data-tab') === activeKey; }) || tabs[0];
              if (activeEl) positionTo(activeEl);
              tabs.forEach(function(t){
                t.addEventListener('mouseenter', function(){ positionTo(t); });
              });
              nav.addEventListener('mouseleave', function(){ if (activeEl) positionTo(activeEl); });
            }
          } catch (e) {}
          setIcon(root.classList.contains('dark'));
          if (btn) {
            btn.setAttribute('aria-pressed', String(root.classList.contains('dark')));
          }
          if (btn && !btn._bound) {
            btn.addEventListener('click', function() {
              var isDark = root.classList.toggle('dark');
              localStorage.setItem('theme', isDark ? 'dark' : 'light');
              setIcon(isDark);
              btn.setAttribute('aria-pressed', String(isDark));
            });
            btn._bound = true;
          }
          function openMobileMenu(){
            if (!mobileMenu) return;
            if (mobileOverlay) {
              mobileOverlay.classList.remove('hidden');
              requestAnimationFrame(function(){ mobileOverlay.classList.remove('opacity-0'); });
            }
            mobileMenu.classList.remove('hidden');
            requestAnimationFrame(function(){
              mobileMenu.classList.remove('opacity-0','-translate-y-1','pointer-events-none');
            });
            if (mobileToggle) mobileToggle.setAttribute('aria-expanded','true');
          }
          function closeMobileMenu(){
            if (!mobileMenu) return;
            if (mobileOverlay) {
              mobileOverlay.classList.add('opacity-0');
              mobileOverlay.addEventListener('transitionend', function onEnd(){
                mobileOverlay.classList.add('hidden');
                mobileOverlay.removeEventListener('transitionend', onEnd);
              });
            }
            mobileMenu.classList.add('opacity-0','-translate-y-1','pointer-events-none');
            mobileMenu.addEventListener('transitionend', function onEnd(){
              mobileMenu.classList.add('hidden');
              mobileMenu.removeEventListener('transitionend', onEnd);
            });
            if (mobileToggle) mobileToggle.setAttribute('aria-expanded','false');
          }
          if (mobileToggle && !mobileToggle._bound) {
            mobileToggle.addEventListener('click', function(e){
              e.preventDefault();
              if (!mobileMenu) return;
              var isOpen = !mobileMenu.classList.contains('hidden');
              if (isOpen) closeMobileMenu(); else openMobileMenu();
            });
            if (mobileMenu) {
              mobileMenu.querySelectorAll('a[data-nav]').forEach(function(a){
                a.addEventListener('click', function(){ closeMobileMenu(); });
              });
            }
            if (mobileOverlay && !mobileOverlay._bound) {
              mobileOverlay.addEventListener('click', closeMobileMenu);
              mobileOverlay._bound = true;
            }
            window.addEventListener('resize', function(){
              try {
                if (window.matchMedia('(min-width: 768px)').matches && mobileMenu) {
                  closeMobileMenu();
                }
              } catch(e) {}
            }, { passive: true });
            mobileToggle._bound = true;
          }
          try {
            var savedLocale = localStorage.getItem('locale');
            if (!savedLocale) {
              var navLang = (navigator.languages && navigator.languages[0]) || navigator.language || '';
              navLang = String(navLang || '').toLowerCase();
              var sys = (navLang.indexOf('zh') === 0 || navLang.indexOf('cn') === 0) ? 'cn' : 'en';
              localStorage.setItem('locale', sys);
              savedLocale = sys;
            }
            if (savedLocale === 'zh') savedLocale = 'cn';
            if (langToggle) { langToggle.textContent = savedLocale === 'en' ? 'EN' : 'CN'; }
            applyLocale(savedLocale);
            if (langToggle && !langToggle._bound) {
              langToggle.addEventListener('click', function() {
                var current = localStorage.getItem('locale') || savedLocale || 'cn';
                if (current === 'zh') current = 'cn';
                var next = current === 'cn' ? 'en' : 'cn';
                localStorage.setItem('locale', next);
                applyLocale(next);
                langToggle.textContent = next === 'en' ? 'EN' : 'CN';
              });
              langToggle._bound = true;
            }
          } catch (e) {}
        }

        // Initial bind
        bindUi();

        // Custom page transition: fade out to white/black then navigate
        var navLinks = document.querySelectorAll('a[data-nav]');
        var NAV_FADE_MS = 100;
        navLinks.forEach(function(a) {
          if (a._boundNav) return;
          a.addEventListener('click', function(e) {
            var href = a.getAttribute('href');
            if (!href || href.startsWith('#') || e.metaKey || e.ctrlKey) return;
            e.preventDefault();
            var isDark = root.classList.contains('dark');
            root.classList.add(isDark ? 'dark-mask' : 'light-mask', 'is-animating');
            setTimeout(function() { window.location.href = href; }, NAV_FADE_MS);
          });
          a._boundNav = true;
        });

        // Smooth page transitions on load (content only); clear any mask
        window.addEventListener('load', function() {
          var container = document.getElementById('swup');
          if (container) container.classList.remove('opacity-0');
          root.classList.remove('light-mask','dark-mask','is-animating');
        });

        // Enable drag-to-scroll for horizontal tag lists
        try {
          var suppressClickUntil = 0;
          // Capture-phase click suppressor to avoid navigating after a drag
          if (!document._tagsClickSuppressor) {
            document.addEventListener('click', function(e){
              if (Date.now() < suppressClickUntil) {
                var card = e.target && e.target.closest && e.target.closest('[data-card]');
                if (card) { e.preventDefault(); e.stopPropagation(); }
              }
            }, true);
            document._tagsClickSuppressor = true;
          }
          function enableDragScroll(el) {
            if (!el || el._dragBound) return;
            var isDown = false; var startX = 0; var scrollLeft = 0; var moved = false;
            // Prevent native drag-out of links/images while dragging
            el.addEventListener('dragstart', function(e){ e.preventDefault(); });
            el.addEventListener('pointerdown', function(e){
              isDown = true; moved = false; startX = e.pageX - el.offsetLeft; scrollLeft = el.scrollLeft; el.setPointerCapture(e.pointerId); el.classList.add('cursor-grabbing');
            });
            el.addEventListener('pointerleave', function(){ isDown = false; el.classList.remove('cursor-grabbing'); });
            el.addEventListener('pointerup', function(e){
              if (moved) {
                // Suppress the immediate click that would navigate
                suppressClickUntil = Date.now() + 250;
                e.preventDefault();
                e.stopPropagation();
              }
              isDown = false; moved = false; el.classList.remove('cursor-grabbing');
            });
            el.addEventListener('pointermove', function(e){
              if (!isDown) return;
              e.preventDefault();
              var x = e.pageX - el.offsetLeft; var walk = (x - startX);
              if (!moved && Math.abs(walk) > 3) moved = true;
              el.scrollLeft = scrollLeft - walk;
            });
            el._dragBound = true;
          }
          function bindDragScroll(){
            document.querySelectorAll('.tags-scroll').forEach(enableDragScroll);
            // Disable drag on all card images and anchors
            document.querySelectorAll('[data-card] img, [data-card]').forEach(function(n){
              try { n.setAttribute('draggable','false'); } catch(e) {}
              n.addEventListener('dragstart', function(e){ e.preventDefault(); });
            });
          }
          bindDragScroll();
          // Re-bind after load in case of dynamic content
          window.addEventListener('load', bindDragScroll);
        } catch (e) {}
      })();
    </script>
  </body>
</html>
